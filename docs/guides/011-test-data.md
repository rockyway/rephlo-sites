# Test Data Documentation

**Version**: 1.0
**Last Updated**: November 2025
**Audience**: Developers, QA Engineers, Testers

This document provides comprehensive information about the test data generated by the Prisma seed script for the Rephlo backend API.

---

## Table of Contents

1. [Overview](#overview)
2. [Seeding the Database](#seeding-the-database)
3. [Test User Accounts](#test-user-accounts)
4. [Testing Scenarios](#testing-scenarios)
5. [Data Reset Procedures](#data-reset-procedures)
6. [Adding Custom Test Data](#adding-custom-test-data)

---

## Overview

The seed script (`backend/prisma/seed.ts`) populates the database with comprehensive test data including:

- **10 Test Users** with various states and authentication methods
- **3 LLM Models** (GPT-5, Claude 3.5 Sonnet, Gemini 2.0 Pro)
- **1 OAuth Client** (Text Assistant Desktop)
- **2 Subscriptions** (Free and Pro tier)
- **3 Credit Records** with different usage patterns
- **2 User Preferences** configurations

This test data covers all major authentication and user management scenarios for thorough testing.

---

## Seeding the Database

### Prerequisites

1. PostgreSQL database running and accessible
2. Database connection configured in `backend/.env`
3. Prisma migrations applied: `npx prisma migrate dev`

### Run Seed Script

```bash
# From backend directory
cd backend

# Run seed script
npm run db:seed

# Alternative command
npx prisma db seed
```

### Expected Output

The seed script outputs a detailed summary:

```
Starting database seeding...

[1/5] Seeding OAuth Clients...
  ‚úì Created/Updated OAuth client: textassistant-desktop

[2/5] Seeding LLM Models...
  ‚úì Created/Updated model: GPT-5 (gpt-5)
  ‚úì Created/Updated model: Gemini 2.0 Pro (gemini-2.0-pro)
  ‚úì Created/Updated model: Claude 3.5 Sonnet (claude-3.5-sonnet)

[3/10] Seeding Test Users...

  üìã Admin User:
    ‚úì Admin: admin@rephlo.com / Admin@123

  üë• Regular Users:
    ‚úì Developer: developer@example.com / User@123
    ‚úì Tester: tester@example.com / User@123 (Email NOT verified)
    ...

‚úÖ Database seeding completed successfully!
```

---

## Test User Accounts

### 1. Admin Account

**Purpose**: Administrative access and testing admin-only features

| Field | Value |
|-------|-------|
| Email | `admin@rephlo.com` |
| Password | `Admin@123` |
| Username | `admin` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Auth Provider | Local |

**Use Cases**:
- Admin panel access
- User management testing
- System configuration
- Full API access

---

### 2. Regular Users (5 Personas)

#### 2.1 Developer User

**Purpose**: Active developer with verified email and API usage

| Field | Value |
|-------|-------|
| Email | `developer@example.com` |
| Password | `User@123` |
| Username | `dev_user` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Auth Provider | Local |

**Use Cases**:
- Normal login flow testing
- API key generation
- Usage tracking
- Credit consumption

---

#### 2.2 Tester User

**Purpose**: Testing email verification flow

| Field | Value |
|-------|-------|
| Email | `tester@example.com` |
| Password | `User@123` |
| Username | `test_user` |
| Email Verified | ‚ùå **No** |
| Active | ‚úÖ Yes |
| Verification Token | `test_verification_token_12345` |
| Token Expiry | 2025-11-10 |
| Auth Provider | Local |

**Use Cases**:
- Email verification testing
- Resend verification email
- Expired verification token testing
- Unverified user restrictions

---

#### 2.3 Designer User

**Purpose**: Recently registered active user

| Field | Value |
|-------|-------|
| Email | `designer@example.com` |
| Password | `User@123` |
| Username | `designer_pro` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Auth Provider | Local |

**Use Cases**:
- New user onboarding
- Default preferences testing
- Fresh account behavior

---

#### 2.4 Manager User

**Purpose**: Testing deactivated account flow

| Field | Value |
|-------|-------|
| Email | `manager@example.com` |
| Password | `User@123` |
| Username | `manager_user` |
| Email Verified | ‚úÖ Yes |
| Active | ‚ùå **No** (Deactivated) |
| Deactivated At | 2025-11-03 16:00:00 |
| Auth Provider | Local |

**Use Cases**:
- Deactivated account login attempt
- Account reactivation flow
- Deactivation workflow testing
- Soft delete scenarios

---

#### 2.5 Support User

**Purpose**: Testing password reset flow

| Field | Value |
|-------|-------|
| Email | `support@example.com` |
| Password | `User@123` |
| Username | `support_agent` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Reset Token | `reset_token_abc123xyz` |
| Token Expiry | 2025-11-07 12:00:00 |
| Auth Provider | Local |

**Use Cases**:
- Password reset flow testing
- Reset token validation
- Password change testing
- Forgot password workflow

---

### 3. OAuth Users (2 Personas)

#### 3.1 Google OAuth User

**Purpose**: Pure Google OAuth authentication

| Field | Value |
|-------|-------|
| Email | `googleuser@gmail.com` |
| Password | ‚ùå None (OAuth only) |
| Username | `google_user` |
| Email Verified | ‚úÖ Yes (Google verified) |
| Active | ‚úÖ Yes |
| Google ID | `mock_google_id_123456789` |
| Auth Provider | Google |

**Use Cases**:
- Google OAuth login flow
- OAuth user creation
- No password authentication
- Social login testing

---

#### 3.2 Mixed Auth User

**Purpose**: Account with both local and Google authentication

| Field | Value |
|-------|-------|
| Email | `mixed@example.com` |
| Password | `User@123` |
| Username | `mixed_auth_user` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Google ID | `mock_google_id_987654321` |
| Auth Provider | Local (original) |

**Use Cases**:
- Account linking testing
- Multiple auth methods
- Google account linking to existing user
- Auth provider switching

---

### 4. Legacy Users (Backward Compatibility)

#### 4.1 Free Tier User

| Field | Value |
|-------|-------|
| Email | `free@example.com` |
| Password | ‚ùå None |
| Username | `freetier` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Subscription | Free Tier |

**Use Cases**:
- Free tier limitations testing
- Credit system testing
- Subscription upgrade flow

---

#### 4.2 Pro Tier User

| Field | Value |
|-------|-------|
| Email | `pro@example.com` |
| Password | ‚ùå None |
| Username | `protier` |
| Email Verified | ‚úÖ Yes |
| Active | ‚úÖ Yes |
| Subscription | Pro Tier |

**Use Cases**:
- Pro tier features testing
- Higher rate limits
- Premium features access
- Subscription downgrade flow

---

## Testing Scenarios

### Scenario 1: Normal Login

**Test Account**: `developer@example.com` / `User@123`

**Expected Flow**:
1. User enters email and password
2. Backend validates credentials
3. Email is verified ‚úÖ
4. Account is active ‚úÖ
5. Session created successfully
6. User redirected to dashboard

**API Endpoint**: `POST /auth/login` (when implemented)

---

### Scenario 2: Unverified Email Login

**Test Account**: `tester@example.com` / `User@123`

**Expected Flow**:
1. User enters email and password
2. Backend validates credentials ‚úÖ
3. Email is NOT verified ‚ùå
4. Login rejected with error: "Please verify your email"
5. Option to resend verification email

**Verification Token**: `test_verification_token_12345`

**API Endpoints**:
- `POST /auth/verify-email`
- `POST /auth/resend-verification`

---

### Scenario 3: Deactivated Account

**Test Account**: `manager@example.com` / `User@123`

**Expected Flow**:
1. User enters email and password
2. Backend validates credentials ‚úÖ
3. Account is deactivated ‚ùå
4. Login rejected with error: "Your account has been deactivated"
5. Option to contact support

**API Endpoint**: `POST /auth/login`

---

### Scenario 4: Password Reset

**Test Account**: `support@example.com`

**Expected Flow**:
1. User clicks "Forgot Password"
2. Enters email: `support@example.com`
3. Backend checks if user exists ‚úÖ
4. Password reset email sent (or use existing token for testing)
5. User clicks reset link with token: `reset_token_abc123xyz`
6. User enters new password
7. Password updated successfully

**API Endpoints**:
- `POST /auth/forgot-password`
- `POST /auth/reset-password`

---

### Scenario 5: Google OAuth Login

**Test Account**: `googleuser@gmail.com` (OAuth only)

**Expected Flow**:
1. User clicks "Sign in with Google"
2. Redirected to Google consent screen
3. User authorizes application
4. Google redirects back with authorization code
5. Backend exchanges code for user info
6. User account found (or created)
7. Session created
8. User redirected to dashboard

**API Endpoints**:
- `GET /oauth/google/authorize`
- `GET /oauth/google/callback`

**Note**: Requires Google OAuth credentials configured in `.env`

---

### Scenario 6: Account Linking

**Test Account**: `mixed@example.com` / `User@123`

**Expected Flow**:
1. User logs in with email/password ‚úÖ
2. User goes to account settings
3. User clicks "Link Google Account"
4. OAuth flow completes
5. Google account linked to existing user
6. User can now login with either method

**Google ID**: `mock_google_id_987654321`

---

### Scenario 7: Admin Access

**Test Account**: `admin@rephlo.com` / `Admin@123`

**Expected Flow**:
1. Admin logs in
2. Access granted to admin panel
3. Can view all users
4. Can manage subscriptions
5. Can view system metrics
6. Full API access

---

## Data Reset Procedures

### Full Database Reset

**Warning**: This will delete ALL data and reseed from scratch.

```bash
cd backend

# Drop all tables and recreate
npx prisma migrate reset

# This command will:
# 1. Drop the database
# 2. Create a new database
# 3. Run all migrations
# 4. Run seed script automatically
```

### Reseed Without Dropping Database

If you want to update seed data without losing other data:

```bash
cd backend

# Run seed script (uses upsert, so safe to run multiple times)
npm run db:seed
```

**Note**: Seed script uses `upsert` operations, so it's safe to run multiple times. It will update existing records instead of creating duplicates.

### Reset Specific User

Use Prisma Studio or direct SQL:

```bash
# Open Prisma Studio
npx prisma studio

# Find user and delete
# Then run seed script to recreate
```

---

## Adding Custom Test Data

### Option 1: Modify Seed Script

Edit `backend/prisma/seed.ts`:

```typescript
// Add your custom user
const customUser = await prisma.user.upsert({
  where: { email: 'custom@example.com' },
  update: {},
  create: {
    email: 'custom@example.com',
    emailVerified: true,
    username: 'custom_user',
    passwordHash: await bcrypt.hash('CustomPass@123', 12),
    firstName: 'Custom',
    lastName: 'User',
    isActive: true,
    authProvider: 'local',
  },
});
```

### Option 2: Use Prisma Studio

```bash
cd backend
npx prisma studio

# Opens browser UI at http://localhost:5555
# Use GUI to add/edit records
```

### Option 3: Use API Endpoints

Once registration endpoints are implemented:

```bash
# Register new user via API
curl -X POST http://localhost:7150/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newuser@example.com",
    "password": "NewPass@123",
    "firstName": "New",
    "lastName": "User"
  }'
```

---

## Password Hashing

All passwords are hashed using `bcrypt` with 12 salt rounds:

```typescript
import bcrypt from 'bcrypt';

const passwordHash = await bcrypt.hash('User@123', 12);
```

**Never store plain text passwords** - even in test environments.

---

## Environment Variables for Testing

Update `backend/.env` for local testing:

```env
# Database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/rephlo_test

# Google OAuth (optional, for OAuth testing)
GOOGLE_CLIENT_ID=your_test_client_id
GOOGLE_CLIENT_SECRET=your_test_client_secret
GOOGLE_REDIRECT_URI=http://localhost:7150/oauth/google/callback

# Frontend URL
FRONTEND_URL=http://localhost:5173
```

---

## Summary of Test Credentials

### Quick Reference Table

| Email | Password | Status | Auth Provider | Use Case |
|-------|----------|--------|---------------|----------|
| `admin@rephlo.com` | `Admin@123` | Active | Local | Admin testing |
| `developer@example.com` | `User@123` | Active | Local | Normal login |
| `tester@example.com` | `User@123` | Unverified | Local | Email verification |
| `designer@example.com` | `User@123` | Active | Local | New user |
| `manager@example.com` | `User@123` | Deactivated | Local | Deactivation flow |
| `support@example.com` | `User@123` | Active | Local | Password reset |
| `googleuser@gmail.com` | N/A | Active | Google | OAuth only |
| `mixed@example.com` | `User@123` | Active | Local + Google | Account linking |
| `free@example.com` | N/A | Active | Local | Free tier |
| `pro@example.com` | N/A | Active | Local | Pro tier |

---

## Next Steps

1. **Run Seed Script**: `cd backend && npm run db:seed`
2. **Start Backend**: `npm run dev`
3. **Start Frontend**: `cd ../frontend && npm run dev`
4. **Test Login Flows**: Use credentials from table above
5. **Configure OAuth**: Follow [Google OAuth Setup Guide](./010-google-oauth-setup.md)

---

## Related Documentation

- [Google OAuth Setup Guide](./010-google-oauth-setup.md)
- [Authentication Endpoints Implementation](../plan/103-auth-endpoints-implementation.md)
- [Prisma Schema Documentation](../../backend/prisma/schema.prisma)
- [Backend API README](../../backend/README.md)

---

**Last Updated**: November 2025
**Document Version**: 1.0
