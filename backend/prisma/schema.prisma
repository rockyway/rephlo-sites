// Prisma Schema for Rephlo Branding Website
// Database: PostgreSQL
// Generated: November 2025

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Download Tracking Model
// Tracks each download event by OS platform
model Download {
  id        String   @id @default(cuid())
  os        String   // "windows", "macos", "linux"
  timestamp DateTime @default(now())
  userAgent String?  // Optional browser/client user agent
  ipHash    String?  // Hashed IP for anonymity and privacy

  @@index([os])
  @@index([timestamp])
  @@map("downloads")
}

// Feedback Submission Model
// Stores user feedback from website or desktop app
model Feedback {
  id        String   @id @default(cuid())
  userId    String?  // Optional user ID from desktop app
  message   String   @db.VarChar(1000) // Max 1000 characters per PRD
  email     String?  // Optional email for follow-up
  timestamp DateTime @default(now())

  @@index([timestamp])
  @@index([email])
  @@map("feedbacks")
}

// Diagnostic Data Model
// Tracks diagnostic log file submissions
// Note: Actual files stored in cloud storage (S3), only metadata here
model Diagnostic {
  id        String   @id @default(cuid())
  userId    String?  // Optional user ID from desktop app
  filePath  String   // Path to file in cloud storage (e.g., S3 key)
  fileSize  Int      // File size in bytes (max 5MB = 5242880 per PRD)
  timestamp DateTime @default(now())

  @@index([timestamp])
  @@index([userId])
  @@map("diagnostics")
}

// App Version Model
// Manages release version metadata and download URLs
model AppVersion {
  id          String   @id @default(cuid())
  version     String   @unique // e.g., "1.0.0", "1.1.0-beta"
  releaseDate DateTime // When this version was released
  downloadUrl String   // URL to binary file (e.g., S3, GitHub Releases)
  changelog   String   @db.Text // Markdown-formatted release notes
  isLatest    Boolean  @default(true) // Flag for current production version
  createdAt   DateTime @default(now())

  @@index([isLatest])
  @@map("app_versions")
}
