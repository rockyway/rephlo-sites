generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admin_audit_log {
  id             String   @id @db.Uuid
  admin_user_id  String   @db.Uuid
  action         String   @db.VarChar(100)
  resource_type  String   @db.VarChar(50)
  resource_id    String?  @db.Uuid
  endpoint       String   @db.VarChar(255)
  method         String   @db.VarChar(10)
  ip_address     String?  @db.VarChar(45)
  user_agent     String?
  request_body   Json?
  previous_value Json?
  new_value      Json?
  status_code    Int
  error_message  String?
  timestamp      DateTime @default(now())
  users          users    @relation(fields: [admin_user_id], references: [id], onDelete: Cascade)

  @@index([admin_user_id, timestamp])
  @@index([resource_type, resource_id])
  @@index([timestamp])
}

model app_settings {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  category     String   @db.VarChar(50)
  key          String   @db.VarChar(100)
  value        Json
  is_encrypted Boolean  @default(false)
  created_at   DateTime @default(now())
  updated_at   DateTime

  @@unique([category, key])
  @@index([category])
}

model app_versions {
  id          String   @id
  version     String   @unique
  releaseDate DateTime
  downloadUrl String
  changelog   String
  isLatest    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@index([isLatest])
}

model approval_requests {
  id                                          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requested_by                                String    @db.Uuid
  action                                      String    @db.VarChar(100)
  target_user_id                              String?   @db.Uuid
  reason                                      String
  status                                      String    @default("pending") @db.VarChar(20)
  reviewed_by                                 String?   @db.Uuid
  reviewed_at                                 DateTime?
  review_notes                                String?
  expires_at                                  DateTime
  created_at                                  DateTime  @default(now())
  users_approval_requests_requested_byTousers users     @relation("approval_requests_requested_byTousers", fields: [requested_by], references: [id])
  users_approval_requests_reviewed_byTousers  users?    @relation("approval_requests_reviewed_byTousers", fields: [reviewed_by], references: [id])

  @@index([expires_at])
  @@index([requested_by])
  @@index([status])
}

model billing_invoice {
  id                        String                     @id @db.Uuid
  user_id                   String                     @db.Uuid
  subscription_id           String?                    @db.Uuid
  stripe_invoice_id         String                     @unique @db.VarChar(255)
  amount_due                Decimal                    @db.Decimal(10, 2)
  amount_paid               Decimal                    @db.Decimal(10, 2)
  currency                  String                     @default("usd") @db.VarChar(3)
  status                    String                     @db.VarChar(20)
  period_start              DateTime
  period_end                DateTime
  invoice_pdf               String?
  hosted_invoice_url        String?
  created_at                DateTime                   @default(now())
  paid_at                   DateTime?
  subscription_monetization subscription_monetization? @relation(fields: [subscription_id], references: [id])
  users                     users                      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  dunning_attempt           dunning_attempt[]
  payment_transaction       payment_transaction[]

  @@index([period_start, period_end])
  @@index([status])
  @@index([stripe_invoice_id])
  @@index([subscription_id])
  @@index([user_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model campaign_coupon {
  id              String          @id @db.Uuid
  campaign_id     String          @db.Uuid
  coupon_id       String          @db.Uuid
  created_at      DateTime        @default(now())
  coupon_campaign coupon_campaign @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  coupon          coupon          @relation(fields: [coupon_id], references: [id], onDelete: Cascade)

  @@unique([campaign_id, coupon_id])
  @@index([campaign_id])
  @@index([coupon_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon {
  id                        String                      @id @db.Uuid
  code                      String                      @unique @db.VarChar(50)
  discount_value            Decimal                     @db.Decimal(10, 2)
  discount_type             discount_type
  currency                  String                      @default("usd") @db.VarChar(3)
  max_uses                  Int?
  max_uses_per_user         Int                         @default(1)
  min_purchase_amount       Decimal?                    @db.Decimal(10, 2)
  tier_eligibility          subscription_tier[]         @default([free, pro, pro_max, enterprise_pro, enterprise_max])
  billing_cycles            String[]                    @default(["monthly", "annual"])
  valid_from                DateTime
  valid_until               DateTime
  is_active                 Boolean                     @default(true)
  campaign_id               String?                     @db.Uuid
  description               String?
  internal_notes            String?
  created_by                String                      @db.Uuid
  created_at                DateTime                    @default(now())
  updated_at                DateTime
  coupon_type               coupon_type
  campaign_coupon           campaign_coupon[]
  coupon_campaign           coupon_campaign?            @relation(fields: [campaign_id], references: [id])
  coupon_analytics_snapshot coupon_analytics_snapshot[]
  coupon_fraud_detection    coupon_fraud_detection[]
  coupon_redemption         coupon_redemption[]
  coupon_usage_limit        coupon_usage_limit?
  coupon_validation_rule    coupon_validation_rule[]

  @@index([campaign_id])
  @@index([code, is_active])
  @@index([coupon_type])
  @@index([valid_from, valid_until, is_active])
  @@index([valid_from, valid_until, is_active], map: "idx_coupon_validity_dates")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon_analytics_snapshot {
  id                              String   @id @db.Uuid
  snapshot_date                   DateTime @unique @db.Date
  total_coupons_active            Int
  total_redemptions               Int
  total_discount_value_usd        Decimal  @db.Decimal(12, 2)
  avg_discount_per_redemption_usd Decimal  @db.Decimal(10, 2)
  top_coupon_code                 String?  @db.VarChar(50)
  conversion_rate                 Decimal  @db.Decimal(5, 2)
  created_at                      DateTime @default(now())
  coupon                          coupon?  @relation(fields: [top_coupon_code], references: [code])

  @@index([snapshot_date])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon_campaign {
  id               String             @id @db.Uuid
  campaign_name    String             @db.VarChar(255)
  campaign_type    campaign_type
  start_date       DateTime
  end_date         DateTime
  budget_limit_usd Decimal            @db.Decimal(12, 2)
  total_spent_usd  Decimal            @default(0) @db.Decimal(12, 2)
  target_tier      subscription_tier?
  is_active        Boolean            @default(true)
  created_by       String             @db.Uuid
  created_at       DateTime           @default(now())
  updated_at       DateTime
  campaign_coupon  campaign_coupon[]
  coupon           coupon[]

  @@index([campaign_type, is_active])
  @@index([start_date, end_date])
  @@index([target_tier])
  @@index([start_date, end_date, is_active], map: "idx_campaign_dates")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon_fraud_detection {
  id             String               @id @db.Uuid
  coupon_id      String               @db.Uuid
  user_id        String               @db.Uuid
  detection_type fraud_detection_type
  severity       fraud_severity
  detected_at    DateTime             @default(now())
  details        Json                 @db.Json
  is_flagged     Boolean              @default(false)
  reviewed_by    String?              @db.Uuid
  reviewed_at    DateTime?
  resolution     String?
  created_at     DateTime             @default(now())
  coupon         coupon               @relation(fields: [coupon_id], references: [id], onDelete: Cascade)

  @@index([coupon_id, severity, is_flagged])
  @@index([detected_at])
  @@index([detection_type])
  @@index([user_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon_redemption {
  id                        String                     @id @db.Uuid
  coupon_id                 String                     @db.Uuid
  user_id                   String                     @db.Uuid
  subscription_id           String?                    @db.Uuid
  redemption_date           DateTime                   @default(now())
  discount_applied_usd      Decimal                    @db.Decimal(10, 2)
  original_amount_usd       Decimal                    @db.Decimal(10, 2)
  final_amount_usd          Decimal                    @db.Decimal(10, 2)
  redemption_status         redemption_status
  failure_reason            String?
  ip_address                String?                    @db.VarChar(45)
  user_agent                String?
  created_at                DateTime                   @default(now())
  is_proration_involved     Boolean                    @default(false)
  proration_amount          Decimal?                   @db.Decimal(10, 2)
  user_tier_before          String?                    @db.VarChar(50)
  user_tier_after           String?                    @db.VarChar(50)
  billing_cycle_before      String?                    @db.VarChar(50)
  billing_cycle_after       String?                    @db.VarChar(50)
  coupon                    coupon                     @relation(fields: [coupon_id], references: [id], onDelete: Cascade)
  subscription_monetization subscription_monetization? @relation(fields: [subscription_id], references: [id])

  @@index([coupon_id, user_id, redemption_date])
  @@index([redemption_date])
  @@index([redemption_status])
  @@index([subscription_id])
  @@index([user_id])
  @@index([redemption_date, redemption_status], map: "idx_coupon_redemption_date")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon_usage_limit {
  id                         String    @id @db.Uuid
  coupon_id                  String    @unique @db.Uuid
  total_uses                 Int       @default(0)
  unique_users               Int       @default(0)
  total_discount_applied_usd Decimal   @default(0) @db.Decimal(12, 2)
  last_used_at               DateTime?
  created_at                 DateTime  @default(now())
  updated_at                 DateTime
  coupon                     coupon    @relation(fields: [coupon_id], references: [id], onDelete: Cascade)

  @@index([last_used_at])
  @@index([total_uses])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model coupon_validation_rule {
  id         String               @id @db.Uuid
  coupon_id  String               @db.Uuid
  rule_type  validation_rule_type
  rule_value Json                 @db.Json
  is_active  Boolean              @default(true)
  created_at DateTime             @default(now())
  updated_at DateTime
  coupon     coupon               @relation(fields: [coupon_id], references: [id], onDelete: Cascade)

  @@index([coupon_id, rule_type, is_active])
}

model credit_allocation {
  id                        String                     @id @db.Uuid
  user_id                   String                     @db.Uuid
  subscription_id           String?                    @db.Uuid
  amount                    Int
  allocation_period_start   DateTime
  allocation_period_end     DateTime
  source                    String                     @db.VarChar(50)
  created_at                DateTime                   @default(now())
  subscription_monetization subscription_monetization? @relation(fields: [subscription_id], references: [id])
  users                     users                      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([allocation_period_start, allocation_period_end])
  @@index([source])
  @@index([subscription_id])
  @@index([user_id])
  @@index([user_id, source, allocation_period_start, allocation_period_end], map: "idx_credit_allocation_source_period")
}

model credit_deduction_ledger {
  id                                                                                 String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                                                                            String                  @db.Uuid
  amount                                                                             Int
  balance_before                                                                     Int
  balance_after                                                                      Int
  request_id                                                                         String?                 @unique @db.Uuid
  token_vendor_cost                                                                  Decimal?                @db.Decimal(10, 8)
  margin_multiplier                                                                  Decimal?                @db.Decimal(4, 2)
  gross_margin                                                                       Decimal?                @db.Decimal(10, 8)
  reason                                                                             credit_deduction_reason
  status                                                                             credit_deduction_status @default(pending)
  reversed_at                                                                        DateTime?
  reversed_by                                                                        String?                 @db.Uuid
  reversal_reason                                                                    String?
  processed_at                                                                       DateTime                @default(now())
  created_at                                                                         DateTime                @default(now())
  token_usage_ledger_credit_deduction_ledger_request_idTotoken_usage_ledger          token_usage_ledger?     @relation("credit_deduction_ledger_request_idTotoken_usage_ledger", fields: [request_id], references: [request_id])
  users_credit_deduction_ledger_reversed_byTousers                                   users?                  @relation("credit_deduction_ledger_reversed_byTousers", fields: [reversed_by], references: [id])
  users_credit_deduction_ledger_user_idTousers                                       users                   @relation("credit_deduction_ledger_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade)
  token_usage_ledger_token_usage_ledger_deduction_record_idTocredit_deduction_ledger token_usage_ledger[]    @relation("token_usage_ledger_deduction_record_idTocredit_deduction_ledger")

  @@index([reason])
  @@index([request_id])
  @@index([status])
  @@index([user_id, created_at])
}

model credit_usage_daily_summary {
  id                  String   @id @db.Uuid
  user_id             String   @db.Uuid
  date                DateTime @db.Date
  credits_allocated   Int      @default(0)
  credits_deducted    Int      @default(0)
  credits_balance_eod Int
  created_at          DateTime @default(now())
  users               users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, date])
  @@index([date])
  @@index([user_id, date])
}

model credits {
  id                   String         @id @db.Uuid
  user_id              String         @db.Uuid
  subscription_id      String?        @db.Uuid
  total_credits        Int
  used_credits         Int            @default(0)
  billing_period_start DateTime
  billing_period_end   DateTime
  is_current           Boolean        @default(true)
  created_at           DateTime       @default(now())
  updated_at           DateTime
  credit_type          String         @default("free") @db.VarChar(10)
  monthly_allocation   Int            @default(2000)
  reset_day_of_month   Int            @default(1)
  subscriptions        subscriptions? @relation(fields: [subscription_id], references: [id])
  users                users          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([billing_period_start, billing_period_end])
  @@index([user_id])
  @@index([user_id, is_current])
  @@index([user_id, credit_type, is_current], map: "idx_credits_user_type_current")
}

model diagnostics {
  id        String   @id
  user_id   String?
  file_path String
  file_size Int
  timestamp DateTime @default(now())

  @@index([timestamp])
  @@index([user_id])
}

model downloads {
  id         String   @id
  os         String
  timestamp  DateTime @default(now())
  user_agent String?
  ip_hash    String?

  @@index([os])
  @@index([timestamp])
}

model dunning_attempt {
  id                        String                     @id @db.Uuid
  user_id                   String                     @db.Uuid
  invoice_id                String                     @db.Uuid
  subscription_id           String?                    @db.Uuid
  attempt_number            Int
  scheduled_at              DateTime
  attempted_at              DateTime?
  result                    String?                    @db.VarChar(20)
  failure_reason            String?
  next_retry_at             DateTime?
  created_at                DateTime                   @default(now())
  billing_invoice           billing_invoice            @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  subscription_monetization subscription_monetization? @relation(fields: [subscription_id], references: [id])
  users                     users                      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([invoice_id])
  @@index([result])
  @@index([scheduled_at])
  @@index([subscription_id])
  @@index([user_id])
}

model feedbacks {
  id        String   @id
  user_id   String?
  message   String   @db.VarChar(1000)
  email     String?
  timestamp DateTime @default(now())

  @@index([email])
  @@index([timestamp])
}

model ip_whitelists {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String   @db.Uuid
  ip_address  String   @db.VarChar(50)
  description String?  @db.VarChar(255)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([ip_address])
  @@index([user_id, is_active])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model license_activation {
  id                  String            @id @db.Uuid
  license_id          String            @db.Uuid
  user_id             String            @db.Uuid
  machine_fingerprint String            @db.VarChar(64)
  device_name         String?           @db.VarChar(255)
  os_type             String?           @db.VarChar(50)
  os_version          String?           @db.VarChar(100)
  cpu_info            String?           @db.VarChar(255)
  activated_at        DateTime          @default(now())
  last_seen_at        DateTime
  deactivated_at      DateTime?
  status              activation_status @default(active)
  created_at          DateTime          @default(now())
  updated_at          DateTime
  ip_address          String?           @db.VarChar(45)
  ip_address_hash     String?           @db.VarChar(64)
  is_suspicious       Boolean           @default(false)
  suspicious_flags    Json?             @default("[]")
  perpetual_license   perpetual_license @relation(fields: [license_id], references: [id], onDelete: Cascade)
  users               users             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([license_id, machine_fingerprint])
  @@index([ip_address_hash], map: "idx_license_activation_ip_hash")
  @@index([is_suspicious], map: "idx_license_activation_suspicious")
  @@index([activated_at])
  @@index([license_id])
  @@index([machine_fingerprint])
  @@index([status])
  @@index([user_id])
}

model margin_audit_log {
  id         String   @id @db.Uuid
  config_id  String   @db.Uuid
  changed_by String   @db.Uuid
  old_margin Decimal? @db.Decimal(5, 2)
  new_margin Decimal  @db.Decimal(5, 2)
  reason     String?
  timestamp  DateTime @default(now())
  users      users    @relation(fields: [changed_by], references: [id])

  @@index([config_id, timestamp])
  @@index([timestamp])
}

model model_provider_pricing {
  id                          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  provider_id                 String    @db.Uuid
  model_name                  String    @db.VarChar(255)
  vendor_model_id             String?   @unique @db.VarChar(255)
  input_price_per_1k          Decimal   @db.Decimal(10, 8)
  output_price_per_1k         Decimal   @db.Decimal(10, 8)
  cache_input_price_per_1k    Decimal?  @db.Decimal(10, 8)
  cache_hit_price_per_1k      Decimal?  @db.Decimal(10, 8)
  effective_from              DateTime
  effective_until             DateTime?
  previous_price_input        Decimal?  @db.Decimal(10, 8)
  previous_price_output       Decimal?  @db.Decimal(10, 8)
  price_change_percent_input  Decimal?  @db.Decimal(5, 2)
  price_change_percent_output Decimal?  @db.Decimal(5, 2)
  detected_at                 DateTime?
  is_active                   Boolean   @default(true)
  description                 String?
  last_verified               DateTime  @default(now())
  verification_frequency_days Int       @default(7)
  created_at                  DateTime  @default(now())
  updated_at                  DateTime
  providers                   providers @relation(fields: [provider_id], references: [id], onDelete: Cascade)

  @@unique([provider_id, model_name, effective_from])
  @@index([effective_from, effective_until])
  @@index([is_active])
  @@index([provider_id, model_name, is_active])
}

model model_tier_audit_logs {
  id             String   @id @db.Uuid
  model_id       String   @db.VarChar(100)
  admin_user_id  String   @db.Uuid
  change_type    String   @db.VarChar(50)
  previous_value Json?
  new_value      Json
  reason         String?
  ip_address     String?  @db.VarChar(45)
  created_at     DateTime @default(now())
  users          users    @relation(fields: [admin_user_id], references: [id])
  models         models   @relation(fields: [model_id], references: [id], onDelete: Cascade)

  @@index([admin_user_id])
  @@index([created_at])
  @@index([model_id])
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model models {
  id                    String                  @id @db.VarChar(100)
  name                  String                  @db.VarChar(255)
  provider              String                  @db.VarChar(100)
  is_available          Boolean                 @default(true)
  created_at            DateTime                @default(now())
  updated_at            DateTime
  is_legacy             Boolean                 @default(false)
  is_archived           Boolean                 @default(false)
  meta                  Json
  model_tier_audit_logs model_tier_audit_logs[]
  user_preferences      user_preferences[]

  @@index([is_archived], map: "idx_models_is_archived")
  @@index([is_available, is_archived], map: "idx_models_is_available_is_archived")
  @@index([is_legacy], map: "idx_models_is_legacy")
  @@index([meta], map: "idx_models_meta_gin", type: Gin)
  @@index([is_available])
  @@index([provider])
}

model oauth_clients {
  client_id          String   @id @db.VarChar(255)
  client_name        String   @db.VarChar(255)
  client_secret_hash String?  @db.VarChar(255)
  redirect_uris      String[]
  grant_types        String[]
  response_types     String[]
  scope              String?
  is_active          Boolean  @default(true)
  created_at         DateTime @default(now())
  config             Json     @default("{}")
  updated_at         DateTime
}

model oidc_models {
  id         String    @id @unique @db.VarChar(255)
  kind       String    @db.VarChar(100)
  payload    Json
  expires_at DateTime?
  grant_id   String?   @db.VarChar(255)
  user_code  String?   @db.VarChar(100)
  uid        String?   @db.VarChar(255)
  created_at DateTime  @default(now())

  @@index([expires_at])
  @@index([grant_id])
  @@index([kind])
  @@index([user_code])
}

model payment_transaction {
  id                        String                     @id @db.Uuid
  user_id                   String                     @db.Uuid
  invoice_id                String?                    @db.Uuid
  subscription_id           String?                    @db.Uuid
  stripe_payment_intent_id  String                     @unique @db.VarChar(255)
  amount                    Decimal                    @db.Decimal(10, 2)
  currency                  String                     @default("usd") @db.VarChar(3)
  status                    String                     @db.VarChar(20)
  payment_method_type       String?                    @db.VarChar(50)
  failure_reason            String?
  created_at                DateTime                   @default(now())
  completed_at              DateTime?
  billing_invoice           billing_invoice?           @relation(fields: [invoice_id], references: [id])
  subscription_monetization subscription_monetization? @relation(fields: [subscription_id], references: [id])
  users                     users                      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([invoice_id])
  @@index([status])
  @@index([stripe_payment_intent_id])
  @@index([subscription_id])
  @@index([user_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model permission {
  id           String              @id @db.Uuid
  name         String              @unique @db.VarChar(100)
  display_name String              @db.VarChar(150)
  description  String?
  category     permission_category
  created_at   DateTime            @default(now())
  updated_at   DateTime

  @@index([category])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model permission_override {
  id                                          String          @id @db.Uuid
  user_id                                     String          @db.Uuid
  permission                                  String          @db.VarChar(100)
  action                                      override_action
  granted_by                                  String          @db.Uuid
  granted_at                                  DateTime
  expires_at                                  DateTime?
  reason                                      String?
  is_active                                   Boolean         @default(true)
  created_at                                  DateTime        @default(now())
  updated_at                                  DateTime
  users_permission_override_granted_byTousers users           @relation("permission_override_granted_byTousers", fields: [granted_by], references: [id])
  users_permission_override_user_idTousers    users           @relation("permission_override_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([expires_at])
  @@index([is_active])
  @@index([user_id])
}

model perpetual_license {
  id                     String               @id @db.Uuid
  user_id                String               @db.Uuid
  license_key            String               @unique @db.VarChar(50)
  purchase_price_usd     Decimal              @db.Decimal(10, 2)
  purchased_version      String               @db.VarChar(50)
  eligible_until_version String               @db.VarChar(50)
  max_activations        Int                  @default(3)
  current_activations    Int                  @default(0)
  status                 license_status       @default(pending)
  purchased_at           DateTime             @default(now())
  activated_at           DateTime?
  expires_at             DateTime?
  created_at             DateTime             @default(now())
  updated_at             DateTime
  license_activation     license_activation[]
  users                  users                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  version_upgrade        version_upgrade[]

  @@index([license_key])
  @@index([purchased_at])
  @@index([status])
  @@index([user_id])
}

model pricing_configs {
  id                                       String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scope_type                               pricing_config_scope_type
  subscription_tier                        subscription_tier?
  provider_id                              String?                        @db.Uuid
  model_id                                 String?                        @db.VarChar(255)
  margin_multiplier                        Decimal                        @db.Decimal(4, 2)
  target_gross_margin_percent              Decimal?                       @db.Decimal(5, 2)
  effective_from                           DateTime
  effective_until                          DateTime?
  reason                                   pricing_config_reason
  reason_details                           String?
  previous_multiplier                      Decimal?                       @db.Decimal(4, 2)
  change_percent                           Decimal?                       @db.Decimal(5, 2)
  expected_margin_change_dollars           Decimal?                       @db.Decimal(12, 2)
  expected_revenue_impact                  Decimal?                       @db.Decimal(12, 2)
  created_by                               String                         @db.Uuid
  approved_by                              String?                        @db.Uuid
  requires_approval                        Boolean                        @default(true)
  approval_status                          pricing_config_approval_status @default(pending)
  is_active                                Boolean                        @default(true)
  monitored                                Boolean                        @default(true)
  created_at                               DateTime                       @default(now())
  updated_at                               DateTime
  users_pricing_configs_approved_byTousers users?                         @relation("pricing_configs_approved_byTousers", fields: [approved_by], references: [id])
  users_pricing_configs_created_byTousers  users                          @relation("pricing_configs_created_byTousers", fields: [created_by], references: [id])
  providers                                providers?                     @relation(fields: [provider_id], references: [id], onDelete: Cascade)

  @@index([approval_status])
  @@index([is_active, effective_from])
  @@index([provider_id, is_active])
  @@index([scope_type])
  @@index([subscription_tier, is_active])
}

model pricing_configuration {
  id                String            @id @db.Uuid
  tier              subscription_tier
  margin_strategy   margin_strategy
  margin_percentage Decimal           @db.Decimal(5, 2)
  effective_date    DateTime
  is_active         Boolean           @default(true)
  created_at        DateTime          @default(now())
  updated_at        DateTime

  @@index([tier, is_active])
}

model proration_event {
  id                         String                    @id @db.Uuid
  user_id                    String                    @db.Uuid
  subscription_id            String                    @db.Uuid
  from_tier                  String?                   @db.VarChar(50)
  to_tier                    String?                   @db.VarChar(50)
  days_remaining             Int
  days_in_cycle              Int
  unused_credit_value_usd    Decimal                   @db.Decimal(10, 2)
  new_tier_prorated_cost_usd Decimal                   @db.Decimal(10, 2)
  net_charge_usd             Decimal                   @db.Decimal(10, 2)
  effective_date             DateTime
  stripe_invoice_id          String?                   @unique @db.VarChar(255)
  status                     proration_status          @default(pending)
  created_at                 DateTime                  @default(now())
  updated_at                 DateTime
  change_type                proration_event_type
  subscription_monetization  subscription_monetization @relation(fields: [subscription_id], references: [id], onDelete: Cascade)
  users                      users                     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([change_type])
  @@index([effective_date])
  @@index([status])
  @@index([subscription_id])
  @@index([user_id])
}

model providers {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String                   @unique @db.VarChar(100)
  api_type               String                   @db.VarChar(50)
  is_enabled             Boolean                  @default(true)
  created_at             DateTime                 @default(now())
  updated_at             DateTime
  model_provider_pricing model_provider_pricing[]
  pricing_configs        pricing_configs[]
  token_usage_ledger     token_usage_ledger[]

  @@index([is_enabled])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model role {
  id                                                String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                                              String                 @unique @db.VarChar(50)
  display_name                                      String                 @db.VarChar(100)
  description                                       String?
  hierarchy                                         Int                    @db.SmallInt
  default_permissions                               Json
  is_active                                         Boolean                @default(true)
  created_at                                        DateTime               @default(now())
  updated_at                                        DateTime
  is_system_role                                    Boolean                @default(false)
  role_change_log_role_change_log_new_role_idTorole role_change_log[]      @relation("role_change_log_new_role_idTorole")
  role_change_log_role_change_log_old_role_idTorole role_change_log[]      @relation("role_change_log_old_role_idTorole")
  user_role_assignment                              user_role_assignment[]

  @@index([hierarchy])
  @@index([is_active])
  @@index([is_system_role])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model role_change_log {
  id                                          String             @id @db.Uuid
  target_user_id                              String             @db.Uuid
  changed_by                                  String             @db.Uuid
  action                                      role_change_action
  old_role_id                                 String?            @db.Uuid
  new_role_id                                 String?            @db.Uuid
  permission_override                         String?
  old_permissions                             String
  new_permissions                             String
  reason                                      String?
  ip_address                                  String?            @db.VarChar(45)
  user_agent                                  String?
  timestamp                                   DateTime           @default(now())
  metadata                                    Json?
  users_role_change_log_changed_byTousers     users              @relation("role_change_log_changed_byTousers", fields: [changed_by], references: [id])
  role_role_change_log_new_role_idTorole      role?              @relation("role_change_log_new_role_idTorole", fields: [new_role_id], references: [id])
  role_role_change_log_old_role_idTorole      role?              @relation("role_change_log_old_role_idTorole", fields: [old_role_id], references: [id])
  users_role_change_log_target_user_idTousers users              @relation("role_change_log_target_user_idTousers", fields: [target_user_id], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([changed_by])
  @@index([target_user_id, timestamp])
  @@index([timestamp])
}

model subscription_monetization {
  id                        String                @id @db.Uuid
  user_id                   String                @db.Uuid
  tier                      subscription_tier
  billing_cycle             String                @db.VarChar(20)
  status                    String                @db.VarChar(20)
  base_price_usd            Decimal               @db.Decimal(10, 2)
  monthly_credit_allocation Int
  stripe_customer_id        String?               @unique @db.VarChar(255)
  stripe_subscription_id    String?               @unique @db.VarChar(255)
  current_period_start      DateTime
  current_period_end        DateTime
  trial_ends_at             DateTime?
  cancelled_at              DateTime?
  created_at                DateTime              @default(now())
  updated_at                DateTime
  billing_invoice           billing_invoice[]
  coupon_redemption         coupon_redemption[]
  credit_allocation         credit_allocation[]
  dunning_attempt           dunning_attempt[]
  payment_transaction       payment_transaction[]
  proration_event           proration_event[]
  users                     users                 @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([status, billing_cycle, base_price_usd], map: "idx_subscription_mrr")
  @@index([current_period_end])
  @@index([status])
  @@index([stripe_customer_id])
  @@index([stripe_subscription_id])
  @@index([tier])
  @@index([user_id])
}

model subscription_tier_config {
  id                        String   @id @db.Uuid
  tier_name                 String   @unique @db.VarChar(50)
  monthly_price_usd         Decimal  @db.Decimal(10, 2)
  annual_price_usd          Decimal  @db.Decimal(10, 2)
  monthly_credit_allocation Int
  max_credit_rollover       Int
  features                  Json     @default("{}")
  is_active                 Boolean  @default(true)

  // Plan 190: Tier Credit Management - Version tracking and rollout control
  config_version            Int      @default(1)
  last_modified_by          String?  @db.Uuid
  last_modified_at          DateTime @default(now())
  apply_to_existing_users   Boolean  @default(false)
  rollout_start_date        DateTime?

  created_at                DateTime @default(now())
  updated_at                DateTime

  @@index([tier_name])
  @@map("subscription_tier_config")
}

// Plan 190: Tier Credit Management - Configuration change history
model tier_config_history {
  id                    String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tier_config_id        String   @db.Uuid
  tier_name             String   @db.VarChar(50)

  // Historical values
  previous_credits      Int
  new_credits           Int
  previous_price_usd    Decimal  @db.Decimal(10, 2)
  new_price_usd         Decimal  @db.Decimal(10, 2)

  // Change metadata
  change_reason         String   @db.Text
  change_type           String   @db.VarChar(50) // 'credit_increase', 'credit_decrease', 'price_change'
  affected_users_count  Int      @default(0)

  // Audit fields
  changed_by            String   @db.Uuid
  changed_at            DateTime @default(now())
  applied_at            DateTime?

  @@index([tier_name, changed_at(sort: Desc)])
  @@index([changed_by])
  @@map("tier_config_history")
}

model subscriptions {
  id                     String               @id @db.Uuid
  user_id                String               @db.Uuid
  tier                   subscription_tier
  status                 subscription_status  @default(active)
  credits_per_month      Int
  credits_rollover       Boolean              @default(false)
  price_cents            Int
  billing_interval       String               @db.VarChar(20)
  stripe_subscription_id String?              @unique @db.VarChar(255)
  stripe_customer_id     String?              @unique @db.VarChar(255)
  current_period_start   DateTime
  current_period_end     DateTime
  trial_end              DateTime?
  created_at             DateTime             @default(now())
  updated_at             DateTime
  cancelled_at           DateTime?
  stripe_price_id        String?              @db.VarChar(255)
  cancel_at_period_end   Boolean              @default(false)
  credits                credits[]
  users                  users                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  token_usage_ledger     token_usage_ledger[]

  @@index([current_period_end])
  @@index([status])
  @@index([user_id])
}

model token_usage_daily_summary {
  id                  String   @id @db.Uuid
  user_id             String   @db.Uuid
  date                DateTime @db.Date
  model_name          String   @db.VarChar(200)
  total_input_tokens  Int
  total_output_tokens Int
  total_cost_usd      Decimal  @db.Decimal(10, 2)
  total_credits       Int
  created_at          DateTime @default(now())
  users               users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, date, model_name])
  @@index([date])
  @@index([user_id, date])
}

model token_usage_ledger {
  id                                                                                      String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  request_id                                                                              String                   @unique @db.Uuid
  user_id                                                                                 String                   @db.Uuid
  subscription_id                                                                         String?                  @db.Uuid
  model_id                                                                                String                   @db.VarChar(255)
  provider_id                                                                             String                   @db.Uuid
  input_tokens                                                                            Int
  output_tokens                                                                           Int
  cached_input_tokens                                                                     Int                      @default(0)
  vendor_cost                                                                             Decimal                  @db.Decimal(10, 8)
  margin_multiplier                                                                       Decimal                  @db.Decimal(4, 2)
  credit_value_usd                                                                        Decimal                  @db.Decimal(10, 8)
  credits_deducted                                                                        Int
  request_type                                                                            request_type
  streaming_segments                                                                      Int?
  request_started_at                                                                      DateTime
  request_completed_at                                                                    DateTime
  processing_time_ms                                                                      Int?
  status                                                                                  request_status           @default(success)
  error_message                                                                           String?
  is_streaming_complete                                                                   Boolean                  @default(true)
  user_tier_at_request                                                                    String?                  @db.VarChar(50)
  region                                                                                  String?                  @db.VarChar(50)
  deduction_record_id                                                                     String?                  @db.Uuid
  created_at                                                                              DateTime                 @default(now())
  gross_margin_usd                                                                        Decimal                  @default(0) @db.Decimal(10, 8)
  credit_deduction_ledger_credit_deduction_ledger_request_idTotoken_usage_ledger          credit_deduction_ledger? @relation("credit_deduction_ledger_request_idTotoken_usage_ledger")
  credit_deduction_ledger_token_usage_ledger_deduction_record_idTocredit_deduction_ledger credit_deduction_ledger? @relation("token_usage_ledger_deduction_record_idTocredit_deduction_ledger", fields: [deduction_record_id], references: [id])
  providers                                                                               providers                @relation(fields: [provider_id], references: [id])
  subscriptions                                                                           subscriptions?           @relation(fields: [subscription_id], references: [id])
  users                                                                                   users                    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at(sort: Desc), status, provider_id, user_id, gross_margin_usd, vendor_cost, credits_deducted, input_tokens, output_tokens], map: "idx_token_usage_analytics")
  @@index([created_at, user_id, status], map: "idx_token_usage_date")
  @@index([model_id, created_at])
  @@index([provider_id, created_at])
  @@index([request_id])
  @@index([status])
  @@index([user_id, created_at])
  @@index([user_id, vendor_cost])
}

model user_credit_balance {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id               String    @unique @db.Uuid
  amount                Int       @default(0)
  last_deduction_at     DateTime?
  last_deduction_amount Int?
  updated_at            DateTime
  created_at            DateTime  @default(now())
  users                 users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model user_preferences {
  user_id              String   @id @db.Uuid
  default_model_id     String?  @db.VarChar(100)
  enable_streaming     Boolean  @default(true)
  max_tokens           Int      @default(4096)
  temperature          Decimal  @default(0.7) @db.Decimal(3, 2)
  preferences_metadata Json?
  created_at           DateTime @default(now())
  updated_at           DateTime
  email_notifications  Boolean  @default(true)
  usage_alerts         Boolean  @default(true)
  models               models?  @relation(fields: [default_model_id], references: [id])
  users                users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_role_assignment {
  id                                            String    @id @db.Uuid
  user_id                                       String    @db.Uuid
  role_id                                       String    @db.Uuid
  assigned_by                                   String    @db.Uuid
  assigned_at                                   DateTime
  expires_at                                    DateTime?
  is_active                                     Boolean   @default(true)
  created_at                                    DateTime  @default(now())
  updated_at                                    DateTime
  users_user_role_assignment_assigned_byTousers users     @relation("user_role_assignment_assigned_byTousers", fields: [assigned_by], references: [id])
  role                                          role      @relation(fields: [role_id], references: [id])
  users_user_role_assignment_user_idTousers     users     @relation("user_role_assignment_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, role_id])
  @@index([expires_at])
  @@index([is_active])
  @@index([role_id])
  @@index([user_id])
}

model user_suspensions {
  id                                         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                                    String    @db.Uuid
  suspended_by                               String    @db.Uuid
  reason                                     String
  suspended_at                               DateTime  @default(now())
  expires_at                                 DateTime?
  lifted_at                                  DateTime?
  lifted_by                                  String?   @db.Uuid
  users_user_suspensions_lifted_byTousers    users?    @relation("user_suspensions_lifted_byTousers", fields: [lifted_by], references: [id])
  users_user_suspensions_suspended_byTousers users     @relation("user_suspensions_suspended_byTousers", fields: [suspended_by], references: [id])
  users_user_suspensions_user_idTousers      users     @relation("user_suspensions_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([suspended_by])
  @@index([user_id])
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  id                                                                 String                       @id @db.Uuid
  email                                                              String                       @unique @db.VarChar(255)
  email_verified                                                     Boolean                      @default(false)
  username                                                           String?                      @db.VarChar(100)
  password_hash                                                      String?                      @db.VarChar(255)
  first_name                                                         String?                      @db.VarChar(100)
  last_name                                                          String?                      @db.VarChar(100)
  profile_picture_url                                                String?
  created_at                                                         DateTime                     @default(now())
  updated_at                                                         DateTime
  last_login_at                                                      DateTime?
  is_active                                                          Boolean                      @default(true)
  deleted_at                                                         DateTime?
  email_verification_token                                           String?                      @db.VarChar(255)
  email_verification_token_expiry                                    DateTime?
  password_reset_token                                               String?                      @db.VarChar(255)
  password_reset_token_expiry                                        DateTime?
  deactivated_at                                                     DateTime?
  google_id                                                          String?                      @unique @db.VarChar(255)
  google_profile_url                                                 String?
  auth_provider                                                      String                       @default("local") @db.VarChar(50)
  last_password_change                                               DateTime?
  password_reset_count                                               Int                          @default(0)
  role                                                               String                       @default("user") @db.VarChar(20)
  mfa_enabled                                                        Boolean                      @default(false)
  mfa_secret                                                         String?                      @db.VarChar(255)
  mfa_backup_codes                                                   String?
  mfa_verified_at                                                    DateTime?
  mfa_method                                                         String?                      @db.VarChar(20)
  status                                                             user_status                  @default(active)
  suspended_until                                                    DateTime?
  banned_at                                                          DateTime?
  lifetime_value                                                     Int                          @default(0)
  has_active_perpetual_license                                       Boolean                      @default(false)
  admin_audit_log                                                    admin_audit_log[]
  approval_requests_approval_requests_requested_byTousers            approval_requests[]          @relation("approval_requests_requested_byTousers")
  approval_requests_approval_requests_reviewed_byTousers             approval_requests[]          @relation("approval_requests_reviewed_byTousers")
  billing_invoice                                                    billing_invoice[]
  credit_allocation                                                  credit_allocation[]
  credit_deduction_ledger_credit_deduction_ledger_reversed_byTousers credit_deduction_ledger[]    @relation("credit_deduction_ledger_reversed_byTousers")
  credit_deduction_ledger_credit_deduction_ledger_user_idTousers     credit_deduction_ledger[]    @relation("credit_deduction_ledger_user_idTousers")
  credit_usage_daily_summary                                         credit_usage_daily_summary[]
  credits                                                            credits[]
  dunning_attempt                                                    dunning_attempt[]
  ip_whitelists                                                      ip_whitelists[]
  license_activation                                                 license_activation[]
  margin_audit_log                                                   margin_audit_log[]
  model_tier_audit_logs                                              model_tier_audit_logs[]
  payment_transaction                                                payment_transaction[]
  permission_override_permission_override_granted_byTousers          permission_override[]        @relation("permission_override_granted_byTousers")
  permission_override_permission_override_user_idTousers             permission_override[]        @relation("permission_override_user_idTousers")
  perpetual_license                                                  perpetual_license[]
  pricing_configs_pricing_configs_approved_byTousers                 pricing_configs[]            @relation("pricing_configs_approved_byTousers")
  pricing_configs_pricing_configs_created_byTousers                  pricing_configs[]            @relation("pricing_configs_created_byTousers")
  proration_event                                                    proration_event[]
  role_change_log_role_change_log_changed_byTousers                  role_change_log[]            @relation("role_change_log_changed_byTousers")
  role_change_log_role_change_log_target_user_idTousers              role_change_log[]            @relation("role_change_log_target_user_idTousers")
  subscription_monetization                                          subscription_monetization[]
  subscriptions                                                      subscriptions[]
  token_usage_daily_summary                                          token_usage_daily_summary[]
  token_usage_ledger                                                 token_usage_ledger[]
  user_credit_balance                                                user_credit_balance?
  user_preferences                                                   user_preferences?
  user_role_assignment_user_role_assignment_assigned_byTousers       user_role_assignment[]       @relation("user_role_assignment_assigned_byTousers")
  user_role_assignment_user_role_assignment_user_idTousers           user_role_assignment[]       @relation("user_role_assignment_user_idTousers")
  user_suspensions_user_suspensions_lifted_byTousers                 user_suspensions[]           @relation("user_suspensions_lifted_byTousers")
  user_suspensions_user_suspensions_suspended_byTousers              user_suspensions[]           @relation("user_suspensions_suspended_byTousers")
  user_suspensions_user_suspensions_user_idTousers                   user_suspensions[]           @relation("user_suspensions_user_idTousers")
  version_upgrade                                                    version_upgrade[]
  webhook_configs                                                    webhook_configs?

  @@index([created_at])
  @@index([email])
  @@index([google_id])
  @@index([mfa_enabled])
  @@index([role])
}

model version_upgrade {
  id                       String            @id @db.Uuid
  license_id               String            @db.Uuid
  user_id                  String            @db.Uuid
  from_version             String            @db.VarChar(50)
  to_version               String            @db.VarChar(50)
  upgrade_price_usd        Decimal           @db.Decimal(10, 2)
  stripe_payment_intent_id String?           @unique @db.VarChar(255)
  status                   upgrade_status    @default(pending)
  purchased_at             DateTime          @default(now())
  created_at               DateTime          @default(now())
  updated_at               DateTime
  perpetual_license        perpetual_license @relation(fields: [license_id], references: [id], onDelete: Cascade)
  users                    users             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([from_version, to_version])
  @@index([license_id])
  @@index([purchased_at])
  @@index([status])
  @@index([user_id])
}

model webhook_configs {
  id             String         @id @db.Uuid
  user_id        String         @unique @db.Uuid
  webhook_url    String         @db.VarChar(2048)
  webhook_secret String         @db.VarChar(255)
  is_active      Boolean        @default(true)
  created_at     DateTime       @default(now())
  updated_at     DateTime
  users          users          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  webhook_logs   webhook_logs[]

  @@index([is_active])
  @@index([user_id])
}

model webhook_logs {
  id                String          @id @db.Uuid
  webhook_config_id String          @db.Uuid
  event_type        String          @db.VarChar(100)
  payload           Json
  status            String          @db.VarChar(20)
  status_code       Int?
  response_body     String?
  error_message     String?
  attempts          Int             @default(1)
  created_at        DateTime        @default(now())
  completed_at      DateTime?
  webhook_configs   webhook_configs @relation(fields: [webhook_config_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([event_type])
  @@index([status])
  @@index([webhook_config_id])
}

enum activation_status {
  active
  deactivated
  replaced
}

enum campaign_type {
  seasonal
  win_back
  referral
  promotional
  early_bird
}

enum coupon_type {
  percentage
  fixed_amount
  tier_specific
  duration_bonus
  perpetual_migration
}

enum credit_deduction_reason {
  api_completion
  subscription_allocation
  manual_adjustment
  refund
  overage
  bonus
  referral
  coupon
}

enum credit_deduction_status {
  pending
  completed
  reversed
}

enum credit_source_type {
  monthly_allocation
  referral_reward
  coupon_promotion
  bonus
  refund
  admin_grant
}

enum deduction_type {
  inference
  embedding
  fine_tuning
  custom
}

enum discount_type {
  percentage
  fixed_amount
  credits
  months_free
}

enum fraud_detection_type {
  velocity_abuse
  ip_switching
  bot_pattern
  device_fingerprint_mismatch
  stacking_abuse
}

enum fraud_severity {
  low
  medium
  high
  critical
}

enum license_status {
  pending
  active
  suspended
  revoked
  expired
}

enum margin_strategy {
  fixed_percentage
  tiered
  dynamic
}

enum model_capability {
  text
  vision
  function_calling
  code
  long_context
}

enum override_action {
  grant
  revoke
}

enum permission_category {
  subscriptions
  licenses
  coupons
  campaigns
  credits
  users
  roles
  analytics
}

enum pricing_config_approval_status {
  pending
  approved
  rejected
}

enum pricing_config_reason {
  initial_setup
  vendor_price_change
  tier_optimization
  margin_protection
  manual_adjustment
}

enum pricing_config_scope_type {
  tier
  provider
  model
  combination
}

enum proration_event_type {
  upgrade
  downgrade
  interval_change
  migration
  cancellation
}

enum proration_status {
  pending
  applied
  failed
  reversed
}

enum redemption_status {
  success
  failed
  reversed
  pending
}

enum request_status {
  success
  failed
  cancelled
  rate_limited
}

enum request_type {
  completion
  streaming
  batch
}

enum role_change_action {
  role_assigned
  role_changed
  role_revoked
  permission_override_granted
  permission_override_revoked
  permission_override_expired
}

enum role_name {
  super_admin
  admin
  ops
  support
  analyst
  auditor
}

enum subscription_status {
  active
  cancelled
  expired
  suspended
  trial
  past_due
  grace_period
}

enum subscription_tier {
  free
  pro
  pro_plus // NEW: $45/month tier
  pro_max
  enterprise_pro // Coming Q2 2026
  enterprise_pro_plus // NEW: Coming Q2 2026
  enterprise_max // DEPRECATED: Use enterprise_pro_plus
  perpetual
}

enum upgrade_status {
  pending
  completed
  failed
  refunded
}

enum usage_operation {
  completion
  chat
  embedding
  function_call
}

enum user_status {
  active
  suspended
  banned
  deleted
}

enum validation_rule_type {
  first_time_user_only
  specific_email_domain
  minimum_credit_balance
  exclude_refunded_users
  require_payment_method
}

enum vendor_name {
  openai
  anthropic
  google
  meta
  mistral
  cohere
}
